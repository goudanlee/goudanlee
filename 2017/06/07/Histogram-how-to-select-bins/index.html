<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="goudanlee's blog"><title>Histogram how to select bins | GoudanLee</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Histogram how to select bins</h1><a id="logo" href="/.">GoudanLee</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Histogram how to select bins</h1><div class="post-meta">Jun 7, 2017<span> | </span><span class="category"><a href="/categories/数据分析/">数据分析</a></span></div><a data-disqus-identifier="2017/06/07/Histogram-how-to-select-bins/" href="/2017/06/07/Histogram-how-to-select-bins/#disqus_thread" class="disqus-comment-count"></a><div class="post-content"><p>今天在进行EDA数据探索时，使用的数据集里有比较多的字段存在异常值的情况，在使用histogram探索这些数据时，这种异常值的处理无非就是调整直方图的参数，过滤异常值等，最后生成一个normal histogram。在调试过程中，产生了一个疑惑，究竟histogram的bins 以及 binwidth到底如何确定呢？</p>
<p>实际上，对一个数据集来说，并没有最好的bins一说，只能根据数据集的特定进行不断的调整，获得一个相对来说最优的bins，使得直方图可以清楚的反应数据的分布情况。</p>
<h3 id="Number-of-bins-and-width"><a href="#Number-of-bins-and-width" class="headerlink" title="Number of bins and width"></a>Number of bins and width</h3><p>There is no “best” number of bins, and different bin sizes can reveal different features of the data. Grouping data is at least as old as Graunt’s work in the 17th century, but no systematic guidelines were given[10] until Sturges’s work in 1926.[11]</p>
<p>Using wider bins where the density is low reduces noise due to sampling randomness; using narrower bins where the density is high (so the signal drowns the noise) gives greater precision to the density estimation. Thus varying the bin-width within a histogram can be beneficial. Nonetheless, equal-width bins are widely used.</p>
<p>Some theoreticians have attempted to determine an optimal number of bins, but these methods generally make strong assumptions about the shape of the distribution. Depending on the actual data distribution and the goals of the analysis, different bin widths may be appropriate, so experimentation is usually needed to determine an appropriate width. There are, however, various useful guidelines and rules of thumb.[</p>
<h3 id="数量和宽度"><a href="#数量和宽度" class="headerlink" title="数量和宽度"></a>数量和宽度</h3><p>没有“最好”的数据箱，不同的大小可以显示数据的不同特征。分组数据至少与Graunt在17世纪的工作一样古老，但在1926年Sturges的工作之前没有给出系统的指导原则[10]。[11]</p>
<p>使用较宽的密度较低的区域可减少由于采样随机性引起的噪声; 使用密度较高的较窄的箱体（因此信号淹没噪声）可以提供更高的密度估计精度。因此，改变直方图内的二进制位宽度是有益的。尽管如此，宽宽度相同的机箱也被广泛使用。</p>
<p>一些理论家试图确定最佳数量的分数，但是这些方法通常对分布的形状做出强烈的假设。根据实际数据分布和分析目标，不同的箱宽可能是适当的，因此通常需要进行实验来确定适当的宽度。然而，有各种有用的指导方针和经验法则。</p>
<p>wikipedia提供的方法：
<a href="https://en.wikipedia.org/wiki/Histogram" target="_blank" rel="external">https://en.wikipedia.org/wiki/Histogram</a></p>
<p>在stackoverflow上也有一个比较不错的方法，实际上是使用了Freedman-Diaconis rule：</p>
<p>The Freedman-Diaconis rule is very robust and works well in practice. The bin-width is set to</p>
<p>h=2∗IQR∗n^1/3 </p>
<p>So the number of bins is (max-min)/h.</p>
<p>In base R, you can use<br><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hist(x,breaks=<span class="string">"FD"</span>)</div></pre></td></tr></table></figure></p>
<p>For other plotting libraries without this option (e.g. ggplot2), you can calculate binwidth as:
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">bins &lt;- diff(range(x)) / (<span class="number">2</span> * IQR(x) / length(x)^(<span class="number">1</span>/<span class="number">3</span>))</div><div class="line"></div><div class="line"><span class="comment"># for example</span></div><div class="line">ggplot() + geom_histogram(aes(x), bins = bw)</div></pre></td></tr></table></figure></p>
<p>Freedman-Diaconis rule基于由IQR表示的四分位数范围。它将Scott的规则的3.5σ替换为2 IQR，其对数据中的异常值的标准偏差较不敏感。总的来说这个方法在处理直方图时效果不错，而且能避开异常值对直方图的影响。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><h4 id="Freedman-Diaconis-rule"><a href="#Freedman-Diaconis-rule" class="headerlink" title="Freedman-Diaconis rule"></a>Freedman-Diaconis rule</h4><p>The Freedman–Diaconis rule is:
<img src="/2017/06/07/Histogram-how-to-select-bins/1.svg" alt="Freedman-Diaconis rule" title="Freedman-Diaconis rule"></p>
<p>The number of bins k can be assigned directly or can be calculated from a suggested bin width h as:
<img src="/2017/06/07/Histogram-how-to-select-bins/2.svg" alt="Number of bins k" title="Number of bins k"></p>
<p>在R中有方便的自带函数可以使用,ggplot使用稍微麻烦一点
<figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># hist()</span></div><div class="line">hist(x,breaks=<span class="string">"FD"</span>)</div><div class="line"></div><div class="line"><span class="comment"># ggplot</span></div><div class="line">bins &lt;- diff(range(x)) / (<span class="number">2</span> * IQR(x) / length(x)^(<span class="number">1</span>/<span class="number">3</span>))</div><div class="line">ggplot() + geom_histogram(aes(x), bins = bw)</div><div class="line"></div><div class="line"><span class="comment"># ggplot</span></div><div class="line">bw &lt;- (<span class="number">2</span> * IQR(x) / length(x)^(<span class="number">1</span>/<span class="number">3</span>))</div><div class="line">ggplot() + geom_histogram(aes(x), binwidth = bw)</div></pre></td></tr></table></figure></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://goudanlee.com/2017/06/07/Histogram-how-to-select-bins/" data-id="cj43wsou500091ktw0c2fq7mf" class="article-share-link">分享</a><div class="tags"><a href="/tags/R/">R</a><a href="/tags/DAND/">DAND</a><a href="/tags/数据分析/">数据分析</a></div><div class="post-nav"><a href="/2017/06/09/WineQualityReds/" class="pre">WineQualityReds EDA</a><a href="/2017/06/01/靈魂歌手/" class="next">靈魂歌手</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论 「请确保 disqus.com 可以正常加载」</button></div><script>var disqus_shortname = 'goudanlee-com';
var disqus_identifier = '2017/06/07/Histogram-how-to-select-bins/';
var disqus_title = 'Histogram how to select bins';
var disqus_url = 'http://goudanlee.com/2017/06/07/Histogram-how-to-select-bins/';
$('.btn_click_load').click(function() {
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  $('.btn_click_load').css('display','none');
});
$.ajax({
  url: 'https://disqus.com/favicon.ico',
  timeout: 3000,
  type: 'GET',
  success: (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    $('.btn_click_load').css('display','none');
  })(),
  error: function() {
    $('.btn_click_load').css('display','block');
  }
});</script><script id="dsq-count-scr" src="//goudanlee-com.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/DAND/">DAND</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Oracle/">Oracle</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/R/">R</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Shell/">Shell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据分析/">数据分析</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/机器学习/">机器学习</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/CentOS/" style="font-size: 12.14px;">CentOS</a> <a href="/tags/Python/" style="font-size: 20.71px;">Python</a> <a href="/tags/lxml/" style="font-size: 10px;">lxml</a> <a href="/tags/R/" style="font-size: 16.43px;">R</a> <a href="/tags/DAND/" style="font-size: 22.86px;">DAND</a> <a href="/tags/机器学习/" style="font-size: 14.29px;">机器学习</a> <a href="/tags/算法/" style="font-size: 10px;">算法</a> <a href="/tags/朴素贝叶斯/" style="font-size: 10px;">朴素贝叶斯</a> <a href="/tags/HEXO/" style="font-size: 10px;">HEXO</a> <a href="/tags/数据分析/" style="font-size: 18.57px;">数据分析</a> <a href="/tags/Redhat/" style="font-size: 12.14px;">Redhat</a> <a href="/tags/BeatifulSoup/" style="font-size: 10px;">BeatifulSoup</a> <a href="/tags/Linux/" style="font-size: 16.43px;">Linux</a> <a href="/tags/Oracle/" style="font-size: 25px;">Oracle</a> <a href="/tags/SVM/" style="font-size: 10px;">SVM</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/MongoDB/" style="font-size: 10px;">MongoDB</a> <a href="/tags/Shell/" style="font-size: 14.29px;">Shell</a> <a href="/tags/Zabbix/" style="font-size: 10px;">Zabbix</a> <a href="/tags/线性回归/" style="font-size: 10px;">线性回归</a> <a href="/tags/靈魂歌手/" style="font-size: 10px;">靈魂歌手</a> <a href="/tags/Data-scientist/" style="font-size: 10px;">Data scientist</a> <a href="/tags/Pandas/" style="font-size: 10px;">Pandas</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/06/19/线性回归的R-square/">线性回归的R-square</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/19/SupportVectorMachine/">机器学习常见算法之支持向量机SVM</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/13/NavieBayes/">机器学习常见算法之朴素贝叶斯(Navie Bayes)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/09/WineQualityReds/">WineQualityReds EDA</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/07/Histogram-how-to-select-bins/">Histogram how to select bins</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/01/靈魂歌手/">靈魂歌手</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/25/Correlation-Pearson-Kendall-Spearman/">Pearson, Kendall, Spearman三种相关性的差异</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/21/R-operators/">R 逻辑操作符</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/20/dand-osm/">DAND“整理 OpenStreetMap 数据”学习总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/24/数据科学家与数据工程师/">数据科学家与数据工程师</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//goudanlee-com.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/goudanlee/goudanlee.github.io" title="Github" target="_blank">Github</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">GoudanLee.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>